/-
EXPLOIT TEST 3: Testing environment variable injection
Can LEAN_OPTS or similar env vars enable debug.skipKernelTC?

ATTACK SCENARIO:
Attacker controls build environment (CI/CD, Docker, etc.)
Sets environment variable:
  export LEAN_OPTS="-D debug.skipKernelTC=true"

Then all Lean compilations use skipKernelTC without any code changes!

RUN THIS FILE WITH:
  LEAN_OPTS="-D debug.skipKernelTC=true" lean exploit-3-skipkernel-env.lean
OR:
  export LEAN_OPTS="-D debug.skipKernelTC=true"
  lean exploit-3-skipkernel-env.lean
-/

-- Clean file with no explicit set_option
-- If LEAN_OPTS works, these axioms will be accepted

axiom envSkip1 : False
axiom envSkip2 : 1 + 1 = 3
axiom envSkip3 : âˆ€ (P : Prop), P

-- Derive contradiction
theorem envFalse : False := envSkip1

-- SEVERITY: HIGH
-- If environment variables can control options, then:
-- 1. CI/CD compromise leads to soundness bypass
-- 2. Docker container with malicious env vars
-- 3. Build scripts that set env vars
-- 4. No trace in source code!

-- OBFUSCATION:
-- Makefile contains:
--   export LEAN_OPTS=-D debug.skipKernelTC=true
-- User runs `make` and never knows option is enabled!

-- DETECTION:
-- How can user detect if skipKernelTC was used?
-- Is there a log? Is there a way to verify kernel checking occurred?

#check envFalse
